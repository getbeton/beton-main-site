---
import { SITE } from '../../utils/site';

interface Props {
  type?: string;
  title: string;
  description: string;
  url: string;
  faqData?: { question: string; answer: string }[];
  breadcrumbs?: { name: string; url: string }[];
}

const { type, title, description, url, faqData, breadcrumbs } = Astro.props;

const orgSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: SITE.name,
  url: SITE.url,
  logo: `${SITE.url}/images/beton-logo.svg`,
  description: SITE.description,
  sameAs: [SITE.social.github, SITE.social.linkedin, SITE.social.twitter],
  contactPoint: {
    '@type': 'ContactPoint',
    url: `${SITE.url}/pricing`,
    contactType: 'sales',
  },
};

const webSiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE.name,
  url: SITE.url,
  description: SITE.description,
  publisher: { '@type': 'Organization', name: SITE.name },
};

const webPageSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  name: title,
  description,
  url,
  isPartOf: { '@type': 'WebSite', url: SITE.url },
  publisher: { '@type': 'Organization', name: SITE.name },
};

const softwareSchema =
  type === 'SoftwareApplication'
    ? {
        '@context': 'https://schema.org',
        '@type': 'SoftwareApplication',
        name: SITE.name,
        applicationCategory: 'BusinessApplication',
        applicationSubCategory: 'Revenue Intelligence',
        operatingSystem: 'Web',
        description: SITE.description,
        url: SITE.url,
        publisher: { '@type': 'Organization', name: SITE.name },
        offers: [
          {
            '@type': 'Offer',
            name: 'Self-Hosted',
            price: '0',
            priceCurrency: 'USD',
            description: 'Free self-hosted deployment with your own LLM key',
          },
          {
            '@type': 'Offer',
            name: 'Cloud',
            price: '0.50',
            priceCurrency: 'USD',
            description: 'Per tracked user per month',
          },
        ],
        featureList: [
          'Behavioral signal detection',
          'CRM integration (Attio, HubSpot, Zoho, Pipedrive)',
          'PostHog analytics integration',
          'Churn prediction',
          'Expansion revenue detection',
          'PLG conversion tracking',
        ],
      }
    : null;

const faqSchema =
  faqData && faqData.length > 0
    ? {
        '@context': 'https://schema.org',
        '@type': 'FAQPage',
        mainEntity: faqData.map((item) => ({
          '@type': 'Question',
          name: item.question,
          acceptedAnswer: {
            '@type': 'Answer',
            text: item.answer,
          },
        })),
      }
    : null;

const breadcrumbSchema =
  breadcrumbs && breadcrumbs.length > 0
    ? {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: breadcrumbs.map((crumb, i) => ({
          '@type': 'ListItem',
          position: i + 1,
          name: crumb.name,
          item: crumb.url,
        })),
      }
    : null;
---

<script type="application/ld+json" set:html={JSON.stringify(orgSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(webSiteSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(webPageSchema)} />
{softwareSchema && <script type="application/ld+json" set:html={JSON.stringify(softwareSchema)} />}
{faqSchema && <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />}
{breadcrumbSchema && <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />}
