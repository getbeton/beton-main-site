---
import { getEntry, getCollection } from 'astro:content';
import PageLayout from '../layouts/PageLayout.astro';
import { SITE } from '../utils/site';
import Hero from '../components/home/Hero.astro';
import HowItWorks from '../components/home/HowItWorks.astro';
import Features from '../components/home/Features.astro';
import UseCasesPreview from '../components/home/UseCasesPreview.astro';
import Integrations from '../components/home/Integrations.astro';
import BlogPosts from '../components/home/BlogPosts.astro';
// import Testimonials from '../components/home/Testimonials.astro';
import PricingPreview from '../components/home/PricingPreview.astro';
import AlternativesPreview from '../components/home/AlternativesPreview.astro';
import SocialProof from '../components/home/SocialProof.astro';
import CTABanner from '../components/home/CTABanner.astro';
import CTASection from '../components/shared/CTASection.astro';
import DashboardMockup from '../components/illustrations/DashboardMockup.astro';
import SignalFlow from '../components/illustrations/SignalFlow.astro';
import ZigzagDivider from '../components/ui/ZigzagDivider.astro';
import Container from '../components/ui/Container.astro';
import Section from '../components/ui/Section.astro';

const page = await getEntry('pages', 'home');
const hero = page?.data.hero;

const testimonials = await getCollection('testimonials');
const reviewData = testimonials.map((t) => ({
  name: t.data.name,
  role: t.data.role,
  company: t.data.company,
  quote: t.data.quote,
}));
---

<PageLayout
  title={page?.data.seo?.metaTitle}
  description={page?.data.seo?.metaDescription}
  schemaType={page?.data.schemaType}
  reviewData={reviewData}
>
  <!-- Hero: two-column grid -->
  <section class="relative py-14 lg:py-24 overflow-hidden" data-track-section="hero">
    <Container>
      <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
        <!-- Left: text content -->
        <div class="min-w-0">
          <Hero
            headline={hero?.headline || 'Open-Source Revenue Intelligence'}
            primaryCta={hero?.primaryCta}
            secondaryCta={hero?.secondaryCta}
          />
        </div>
        <!-- Right: illustration -->
        <div class="order-last min-w-0">
          <DashboardMockup />
        </div>
      </div>
    </Container>
  </section>

  <ZigzagDivider />

  <!-- Subheadline -->
  {hero?.subheadline && (
    <Section>
      <Container>
        <div class="max-w-3xl mx-auto text-left sm:text-center space-y-4 text-lg sm:text-xl text-[var(--color-text-secondary)] leading-relaxed">
          {hero.subheadline.split('. ').filter(Boolean).map((sentence: string) => (
            <p>{sentence.endsWith('.') ? sentence : `${sentence}.`}</p>
          ))}
        </div>
      </Container>
    </Section>
  )}

  <!-- Signal Flow Diagram -->
  <Section class="border-b-2 border-[var(--color-border)]">
    <Container>
      <SignalFlow />
    </Container>
  </Section>

  <UseCasesPreview />

  <CTASection
    headline="Stop guessing which users will convert"
    description="Connect your product analytics and surface real buying signals â€” no code, no complex setup."
    trackId="mid-page-cta"
  />

  <Features />

  <HowItWorks />

  <!-- CTA after HowItWorks -->
  <CTASection
    headline="Join teams already using Beton"
    description="Open-source, self-hostable, and free to start."
    trackId="social-proof-cta"
  />

  <Integrations />
  <!-- <Testimonials /> -->

  <ZigzagDivider />

  <PricingPreview />
  <BlogPosts />

  <CTABanner />

  <AlternativesPreview />
</PageLayout>
